@using Aifud.Services
@model Pedido
@inject ConsultaCepService CepService

<h1>Concluir pedido</h1>
@{
    var endereco = await @CepService.ConsultaCep("35170309");
}

<form asp-action="Checkout" asp-controller="Pedido" class="form-horizontal" role="form">

    <div class="row">
        <div class="form-group col-md-4">
            <label asp-for="Nome" class="control-label"></label>
            <input asp-for="Nome" class="form-control" />
            <span asp-validation-for="Nome" class="text-danger"></span>
        </div>
        <div class="form-group col-md-8">
            <label asp-for="Sobrenome" class="control-label"></label>
            <input asp-for="Sobrenome" class="form-control" />
            <span asp-validation-for="Sobrenome" class="text-danger"></span>
        </div>
    </div>

    <div class="row">
        <div class="form-group col-md-8">
            <label asp-for="Endereco" class="control-label"></label>
            <input id="ruaInput" asp-for="Endereco" class="form-control" />
            <span asp-validation-for="Endereco" class="text-danger"></span>
        </div>
        <div class="form-group col-md-2">
            <label asp-for="Numero" class="control-label"></label>
            <input asp-for="Numero" class="form-control" />
            <span asp-validation-for="Numero" class="text-danger"></span>
        </div>
        <div class="form-group col-md-2">
            <label asp-for="Complemento" class="control-label"></label>
            <input asp-for="Complemento" class="form-control" />
            <span asp-validation-for="Complemento" class="text-danger"></span>
        </div>
    </div>

    <div class="row">
        <div class="form-group col-md-2">
            <label asp-for="CEP" class="control-label"></label>
            <input asp-for="CEP" class="form-control" id="cepInput" onChange="OnChangeCep()" />
            <span asp-validation-for="CEP" class="text-danger"></span>
        </div>
        <div class="form-group col-md-6">
            <label asp-for="Cidade" class="control-label"></label>
            <input id="cidadeInput" asp-for="Cidade" class="form-control" />
            <span asp-validation-for="Cidade" class="text-danger"></span>
        </div>
        <div class="form-group col-md-4">
            <label asp-for="Estado" class="control-label"></label>
            <input id="estadoInput" asp-for="Estado" class="form-control" />
            <span asp-validation-for="Estado" class="text-danger"></span>
        </div>
    </div>

    <div class="row">
        <div class="form-group col-md-3">
            <label asp-for="Telefone" class="control-label"></label>
            <input asp-for="Telefone" class="form-control" />
            <span asp-validation-for="Telefone" class="text-danger"></span>
        </div>
        <div class="form-group col-md-9">
            <label asp-for="Email" class="control-label"></label>
            <input asp-for="Email" class="form-control" />
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>
    </div>

    <br />

    <div class="button-group">
        <button class="btn btn-secondary" asp-controller="CarrinhoCompra" asp-action="Index">Voltar</button>
        &nbsp
        <button class="btn btn-success" type="submit">Concluir pedido</button>
    </div>

</form>

<script>
    function OnChangeCep() {
        var cep = document.getElementById("cepInput").value;

        var cidade = document.getElementById("cidadeInput");
        var estado = document.getElementById("estadoInput");
        var rua = document.getElementById("ruaInput");

        $.ajax({
            url: '@Url.Action("GetAddress", "Cep")', // to get the right path to controller from TableRoutes of Asp.Net MVC
            dataType: "json", //to work with json format
            type: "GET", //to do a post request
            cache: false, //avoid caching results
            data: { 'cep': cep }, // here you can pass arguments to your request if you need
            success: function (data) {
                // data is your result from controller
                //alert(data);
                cep.value = data.cep;
                cidade.value = data.city;
                estado.value = data.state;
                rua.value = data.street + ', ' + data.neighborhood;
            },
            error: function (xhr) {
                cep.value = '';
                cep.focus();

            }
        });
    }
</script>